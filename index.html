<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星智學・受孕生命手勢 (Spiritual Depth Edition)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Noto+Sans+TC:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root { --space-blue: #020617; --gold-star: #fbbf24; --glass-bg: rgba(15, 23, 42, 0.95); --serif-font: 'Noto Serif TC', serif; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--space-blue); color: #f1f5f9; margin: 0; }
        .serif { font-family: var(--serif-font); }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid rgba(251, 191, 36, 0.2); border-radius: 4px; }
        .btn-gold { background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%); color: #020617; font-weight: 900; transition: all 0.2s; }
        #starfield { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .aspect-box { background: rgba(255,255,255,0.03); border-left: 3px solid #fbbf24; padding: 15px; margin-top: 10px; }
    </style>
</head>
<body class="p-4 md:p-10">
    <canvas id="starfield"></canvas>

    <header class="max-w-7xl mx-auto mb-10 border-b border-white/10 pb-6 flex flex-col md:flex-row justify-between items-center gap-4">
        <div>
            <p class="text-[10px] text-amber-500 font-bold tracking-[0.5em] mb-2 uppercase">Deep Spiritual Observation</p>
            <h1 class="serif text-4xl md:text-5xl font-black text-white">星智學・受孕生命手勢</h1>
            <p class="text-zinc-500 text-xs mt-2">探索靈魂從星辰下降至肉身的靈性軌跡</p>
        </div>
        <div class="flex gap-3">
            <button id="exportBtn" onclick="exportToPDF()" class="hidden border border-amber-500/50 text-amber-500 px-6 py-2 rounded text-[10px] font-black tracking-widest uppercase hover:bg-amber-500/10">匯出靈性報告</button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto grid lg:grid-cols-12 gap-8">
        <!-- 控制區 -->
        <div class="lg:col-span-4 space-y-6">
            <section class="glass-card p-6">
                <h3 class="serif text-amber-400 mb-6 font-bold">初始化靈魂參數</h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-2 text-[10px] font-bold">
                        <button id="btnSidereal" onclick="setSystem('sidereal')" class="py-2 border border-amber-500 bg-amber-500 text-slate-950 rounded">恆星 (靈魂原意)</button>
                        <button id="btnTropical" onclick="setSystem('tropical')" class="py-2 border border-white/10 text-zinc-500 rounded">回歸 (物質環境)</button>
                    </div>
                    <input type="date" id="birthDate" class="w-full bg-slate-900 border border-white/10 rounded p-3 text-white">
                    <input type="time" id="birthTime" value="12:00" class="w-full bg-slate-900 border border-white/10 rounded p-3 text-white">
                    <button onclick="calculate()" class="btn-gold w-full py-4 rounded text-sm tracking-widest uppercase">啟動靈性觀測</button>
                </div>
            </section>
        </div>

        <!-- 顯示區 -->
        <div id="reportContent" class="lg:col-span-8">
            <div id="displayArea" class="hidden space-y-6">
                <div class="glass-card p-6">
                    <h4 class="text-[10px] font-bold text-zinc-500 mb-4 uppercase tracking-[0.3em]">生命塑造強度節奏</h4>
                    <div style="height: 150px;"><canvas id="gestureChart"></canvas></div>
                </div>

                <div class="grid md:grid-cols-3 gap-4">
                    <div id="monthList" class="space-y-2 overflow-y-auto max-h-[500px]"></div>
                    <div id="detailView" class="md:col-span-2 glass-card p-8 min-h-[500px] relative overflow-hidden">
                        <div id="watermark" class="absolute -right-10 -bottom-10 text-[150px] text-white/5 serif">☉</div>
                        <div id="detailContent" class="relative z-10">
                            <h2 id="detailTitle" class="serif text-3xl text-white font-bold mb-2">請選取觀測月份</h2>
                            <div id="detailBody" class="space-y-6 text-zinc-300"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="placeholder" class="h-64 glass-card flex items-center justify-center text-zinc-600 italic">
                請輸入數據以讀取靈魂的生命手勢...
            </div>
        </div>
    </main>

    <script>
        const PLANET_DATA = {
            "Moon": { zh: "月亮", organ: "乙太胚種與感官", gesture: "映射宇宙的形式", depth: "靈魂在此階段學習「接受」，如同鏡子般吸收宇宙的智慧，轉化為物質的雛形。這是靈魂與母體乙太流動最深的結合。" },
            "Saturn": { zh: "土星", organ: "骨骼與神經邊界", gesture: "業力印記的鎖定", depth: "土星帶來了過去轉世的重量。在此階段，靈魂必須接受物質的限制，建立神經的邊界，這也是人類自我意識覺醒的基礎。" },
            "Jupiter": { zh: "木星", organ: "肝臟與智慧架構", gesture: "思想力量的編織", depth: "木星將宇宙的秩序注入肉體。它代表著擴張與理解，幫助靈魂在肉體中建立一套能反映宇宙智慧的生理運作模式。" },
            "Mars": { zh: "火星", organ: "肌肉與意志血液", gesture: "意志動能的噴發", depth: "火星賦予個體向外行動的力量。在血液與肌肉的形塑中，靈魂學習如何在物質世界中行使權力與克服阻礙。" },
            "Sun": { zh: "太陽", organ: "心臟與自覺中心", gesture: "「我」與生命的整合", depth: "這是受孕歷程的中心點。靈魂的「我執」在此與心臟節奏結合，達成內在與外在、靈性與物質的完美平衡。" },
            "Venus": { zh: "金星", organ: "腎臟與感受能力", gesture: "內在美感的調和", depth: "金星將世界內化。它形塑了我們感受愛與美的器官，讓靈魂具備與他者產生共鳴的能力。" },
            "Mercury": { zh: "水星", organ: "肺部與神經傳導", gesture: "律動與訊息的轉譯", depth: "水星是宇宙與地球之間的橋樑。在呼吸系統的完善中，靈魂準備好在出生後通過呼吸與大自然進行不間斷的溝通。" }
        };

        const ASPECT_INFO = {
            "合相": "力量的合一與強化。代表靈魂在此領域具備極強的專注力與天賦能量。",
            "對分相": "張力與平衡的挑戰。靈魂需要在對立的力量中尋找中立點，這常代表生命中重要的磨練。",
            "三分相": "天賦的和諧流動。代表過去世累積的正面成果，在今生能輕易地運用這份力量。",
            "四分相": "動態的衝突與成長。這是一種必須透過努力才能轉化的業力阻力，是靈魂進化的動力源。"
        };

        const MONTHLY_ARCHETYPE = [null, "Moon", "Saturn", "Jupiter", "Mars", "Sun", "Venus", "Mercury", "Saturn", "Moon"];
        let currentSystem = 'sidereal';
        let storedData = [];

        function setSystem(sys) {
            currentSystem = sys;
            document.getElementById('btnSidereal').className = sys === 'sidereal' ? "py-2 border border-amber-500 bg-amber-500 text-slate-950 rounded" : "py-2 border border-white/10 text-zinc-500 rounded";
            document.getElementById('btnTropical').className = sys === 'tropical' ? "py-2 border border-amber-500 bg-amber-500 text-slate-950 rounded" : "py-2 border border-white/10 text-zinc-500 rounded";
            if(document.getElementById('birthDate').value) calculate();
        }

        function calculate() {
            const birthInput = document.getElementById('birthDate').value;
            if(!birthInput) return;
            const bDate = new Date(`${birthInput}T${document.getElementById('birthTime').value}`);
            const conDate = new Date(bDate); conDate.setDate(bDate.getDate() - 273);

            storedData = [];
            for(let i=1; i<=9; i++) {
                let mDate = new Date(conDate); mDate.setDate(conDate.getDate() + (i * 28));
                let pKey = MONTHLY_ARCHETYPE[i];
                // 模擬隨機相位以展示深度內容
                let mockAspects = [];
                if(Math.random() > 0.4) mockAspects.push({ target: "Sun", name: "三分相", sym: "△" });
                if(Math.random() > 0.7) mockAspects.push({ target: "Mars", name: "四分相", sym: "□" });

                storedData.push({ month: i, date: mDate.toLocaleDateString('zh-TW'), pKey: pKey, planet: PLANET_DATA[pKey], aspects: mockAspects });
            }
            render();
        }

        function render() {
            document.getElementById('placeholder').style.display = 'none';
            document.getElementById('displayArea').style.display = 'block';
            document.getElementById('exportBtn').classList.remove('hidden');
            const list = document.getElementById('monthList');
            list.innerHTML = "";
            storedData.forEach((d, i) => {
                const btn = document.createElement('div');
                btn.className = "p-4 glass-card cursor-pointer hover:bg-amber-500/10 transition-all";
                btn.onclick = () => show(i);
                btn.innerHTML = `<p class="text-[9px] text-amber-500 font-bold">第 ${d.month} 月</p><p class="text-sm font-bold text-white">${d.planet.zh}時期</p>`;
                list.appendChild(btn);
            });
            show(0);
            updateChart();
        }

        function show(idx) {
            const d = storedData[idx];
            document.getElementById('detailTitle').innerText = `${d.planet.zh}時期：${d.planet.gesture}`;
            document.getElementById('watermark').innerText = d.month;
            
            let html = `
                <div class="space-y-4">
                    <p class="text-amber-500 font-bold border-b border-white/10 pb-2">靈魂發展深層意義</p>
                    <p class="leading-relaxed text-sm">${d.planet.depth}</p>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/5 p-4 rounded"><p class="text-[9px] text-zinc-500 mb-1">對應器官</p><p class="text-white font-bold">${d.planet.organ}</p></div>
                        <div class="bg-white/5 p-4 rounded"><p class="text-[9px] text-zinc-500 mb-1">觀測時間</p><p class="text-white font-bold">${d.date}</p></div>
                    </div>

                    <p class="text-amber-500 font-bold border-b border-white/10 pb-2 mt-6">相位對靈性的影響</p>
            `;
            
            if(d.aspects.length > 0) {
                d.aspects.forEach(a => {
                    html += `
                        <div class="aspect-box">
                            <p class="text-white font-bold mb-1">${d.planet.zh} 與 ${PLANET_DATA[a.target].zh} 形成 ${a.name} ${a.sym}</p>
                            <p class="text-xs text-zinc-400 leading-relaxed">${ASPECT_INFO[a.name]}</p>
                        </div>
                    `;
                });
            } else {
                html += `<p class="text-xs italic text-zinc-500">此階段靈魂處於宇宙靜謐期，專注於內在結構的單純整合。</p>`;
            }
            html += `</div>`;
            document.getElementById('detailBody').innerHTML = html;
        }

        function updateChart() {
            const ctx = document.getElementById('gestureChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: storedData.map(d => `M${d.month}`),
                    datasets: [{ label: '能量', data: [60, 75, 65, 85, 95, 70, 80, 65, 90], borderColor: '#fbbf24', tension: 0.4 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false } } }
            });
        }

        function exportToPDF() {
            const element = document.getElementById('reportContent');
            html2pdf().set({ margin: 10, filename: '星智學靈性報告.pdf', html2canvas: { scale: 2, backgroundColor: '#020617' } }).from(element).save();
        }

        // 星空背景
        const cvs = document.getElementById('starfield');
        const ctxS = cvs.getContext('2d');
        window.onresize = () => { cvs.width = window.innerWidth; cvs.height = window.innerHeight; };
        window.onresize();
        for(let i=0; i<100; i++) {
            ctxS.fillStyle = "white"; ctxS.globalAlpha = Math.random();
            ctxS.beginPath(); ctxS.arc(Math.random()*cvs.width, Math.random()*cvs.height, Math.random()*1, 0, Math.PI*2); ctxS.fill();
        }
    </script>
</body>
</html>